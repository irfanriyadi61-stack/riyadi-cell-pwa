<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>RIYADI CELL – OCR & Generator Struk</title>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>
<style>
 body { font-family: Arial; padding: 10px; background: #f5f5f5; }
 .box { background: #fff; padding: 15px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.12); }
 input, textarea { width: 100%; padding: 8px; margin-top: 5px; border-radius: 6px; border: 1px solid #ccc; }
 button { background:#e63946; color:white; padding:12px 18px; border:0; border-radius:8px; margin-top:10px; cursor:pointer; }
 #preview { width:100%; margin-top:10px; border-radius:10px; display:none; }
 #struk58 { font-family: monospace; white-space: pre; background:white; padding:10px; border-radius:10px; }
</style>
</head>
<body>
<h2><b>RIYADI CELL – OCR, Autofill & Generator Struk</b></h2>

<div class="box">
 <label><b>Pilih Gambar Struk</b></label><br>
 <input type="file" id="imageInput" accept="image/*" />
 <img id="preview" />
</div>

<div class="box">
 <button onclick="runOCR()">Proses OCR</button>
 <pre id="ocrResult"></pre>
</div>

<div class="box">
 <h3>Data Struk (Autofill dari OCR)</h3>
 <label>Nama Produk</label>
 <input id="produk" />

 <label>Nomor Tujuan</label>
 <input id="nomor" />

 <label>Harga</label>
 <input id="harga" />

 <label>Waktu Transaksi</label>
 <input id="waktu" />

 <button onclick="generateStruk()">Buat Struk 58mm</button>
</div>

<div class="box">
 <h3>Struk 58mm (Preview)</h3>
 <div id="struk58"></div>
 <button onclick="downloadPDF()">Download PDF</button>
</div>

<script>
const input = document.getElementById('imageInput');
const preview = document.getElementById('preview');

input.addEventListener('change', () => {
 const file = input.files[0];
 if (file) {
   preview.src = URL.createObjectURL(file);
   preview.style.display = "block";
 }
});

function runOCR() {
 const file = input.files[0];
 if (!file) return alert('Pilih gambar dulu');

 Tesseract.recognize(file,'ind').then(r => {
   const text = r.data.text;
   document.getElementById('ocrResult').textContent = text;

   // Autofill sederhana
   document.getElementById('produk').value = (text.match(/(DATA|PULSA|KUOTA).*/i) || [''])[0];
   document.getElementById('nomor').value = (text.match(/08[0-9]{8,12}/) || [''])[0];
   document.getElementById('harga').value = (text.match(/Rp.?\s?[0-9\.]+/) || [''])[0];
   document.getElementById('waktu').value = (text.match(/\d{2}-\d{2}-\d{4}.*/) || [''])[0];
 });
}

function generateStruk() {
 const p = document.getElementById('produk').value;
 const n = document.getElementById('nomor').value;
 const h = document.getElementById('harga').value;
 const w = document.getElementById('waktu').value;

 const format = `RIYADI CELL\n-----------------------------\nProduk : ${p}\nNomor  : ${n}\nHarga  : ${h}\nWaktu  : ${w}\n-----------------------------\nTerima kasih :)`;

 document.getElementById('struk58').textContent = format;
}

function downloadPDF() {
 const { jsPDF } = window.jspdf || {};
 if (!jsPDF) {
   alert('jsPDF belum di-load');
   return;
 }
 const pdf = new jsPDF({unit:'mm', format:[58,100]});
 pdf.setFont('courier');
 pdf.setFontSize(8);
 pdf.text(document.getElementById('struk58').textContent, 2, 5);
 pdf.save('struk_riyadi.pdf');
}
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</body>
</html>
